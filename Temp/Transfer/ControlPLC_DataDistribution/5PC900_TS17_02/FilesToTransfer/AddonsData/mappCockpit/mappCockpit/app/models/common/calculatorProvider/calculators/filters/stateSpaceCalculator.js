define(["require", "exports"], function (require, exports) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var StateSpaceCalculator = /** @class */ (function () {
        function StateSpaceCalculator(nOrder /*! order */, bz /*! vector bz */, az /*! vector az */, bs0, as0) {
            this.bzN = []; /*! normalized vector bz */
            this.azN = []; /*! normalized vector az */
            this.presetCoeff = 0.0; /*! reference to preset coefficient */
            this.nOrder = 0;
            this.xz = []; /*! state-space vector xz */
            this.nOrder = nOrder;
            this.NormCoeffS(bz, az, bs0, as0);
        }
        StateSpaceCalculator.prototype.ClcOutputVector = function (inputVector) {
            // initialize the state space vector so that the first ouput matches the first element in the input vector
            this.StateSpacePreset(inputVector[0]);
            var outputVector = [];
            for (var i = 0; i < inputVector.length; i++) {
                outputVector.push(this.StateSpace(inputVector[i]));
            }
            return outputVector;
        };
        StateSpaceCalculator.prototype.NormCoeffS = function (bz /*! vector bz */, az /*! vector az */, bs0, as0) {
            var presetOK; /* internal variable */
            var iCnt; /* internal variable */
            if (this.nOrder > 0) /* regular case - 0 < nOrder <= 255 */ {
                this.bzN[this.nOrder] = bz[this.nOrder] / az[this.nOrder]; /* normalized bz[n] */
                for (iCnt = this.nOrder - 1; iCnt > 0; iCnt--) /* normalized az & bz (index n-1..1) */ {
                    this.azN[iCnt] = az[iCnt] / az[this.nOrder]; /* normalized az[i] & bz[i], i=n-1..1 */
                    this.bzN[iCnt] = bz[iCnt] / az[this.nOrder] - this.azN[iCnt] * this.bzN[this.nOrder];
                } /* end for() */
                this.azN[0] = az[0] / az[this.nOrder]; /* normalized az[0] & bz[0] */
                this.bzN[0] = bz[0] / az[this.nOrder] - this.azN[0] * this.bzN[this.nOrder];
                this.azN[this.nOrder] = 1.0; /* normalized az[n] */
                if (Math.abs(bs0) <= Number.MIN_VALUE) /* preset of state space output y=y0 is not possible, only reset (y0=0) works */ {
                    this.presetCoeff = 0.0;
                    presetOK = false;
                }
                else /* preset of state space output y = y0 is possible */ {
                    this.presetCoeff = as0 / bs0;
                    presetOK = true;
                } /* end if(ABS(bs0) < FLT_EPSILON) */
            }
            else /* special case - nOrder = 0 */ {
                this.bzN[0] = bz[0] / az[0]; /* normalized bz[n] & az[0] */
                this.azN[0] = 1.0;
                this.presetCoeff = 0.0;
                presetOK = true;
            } /* end if(nOrder > 0) */
            return presetOK;
        }; /* end NormCoeffS() */
        /*! \brief Initialize state-space output y with init value y0. */
        StateSpaceCalculator.prototype.StateSpacePreset = function (y0 /*! init output value */) {
            var iCnt = 0; /*internal variable*/
            var u0 = 0; /*internal variables*/
            var xzn = 0; /*internal variables*/
            if (this.nOrder > 0) /* regular case - 0 < nOrder <= 255 */ {
                u0 = y0 * this.presetCoeff; /* y0 = xz[n-1] + bzN[n] * u0 */
                xzn = y0 - this.bzN[this.nOrder] * u0;
                this.xz[0] = 0.0 - this.azN[0] * xzn + this.bzN[0] * u0; /* xz[0] */
                for (iCnt = 1; iCnt < (this.nOrder - 1); iCnt++) /* state vector (index 1..n-1) */ {
                    this.xz[iCnt] = this.xz[iCnt - 1] - this.azN[iCnt] * xzn + this.bzN[iCnt] * u0; /* xz[i], i=1..n-1 */
                } /* end for() */
                this.xz[this.nOrder - 1] = xzn;
            } /* end if(nOrder > 0) */
            return;
        }; /* end StateSpacePreset() */
        /*! \brief Time discrete SISO state-space system. */
        StateSpaceCalculator.prototype.StateSpace = function (u /*! input */) {
            var iCnt = 0; /* internal variable */
            var xzn = 0.0; /* internal variable */
            var y = 0.0; /* internal variable */
            if (this.nOrder > 0) /* regular case - 0 < nOrder <= 255 */ {
                y = this.xz[this.nOrder - 1] + this.bzN[this.nOrder] * u; /* output y */
                for (xzn = this.xz[this.nOrder - 1], iCnt = this.nOrder - 1; iCnt > 0; iCnt--) /* new state vector (index n-1..1) */ {
                    this.xz[iCnt] = this.xz[iCnt - 1] - this.azN[iCnt] * xzn + this.bzN[iCnt] * u; /* xz[i], i=n-1..1 */
                } /* end for() */
                this.xz[0] = 0.0 - this.azN[0] * xzn + this.bzN[0] * u; /* xz[0] */
            }
            else /* special case - nOrder = 0 */ {
                y = this.bzN[0] * u; /* output y */
            } /* end if(nOrder > 0) */
            return y;
        }; /* end StateSpace() */
        return StateSpaceCalculator;
    }());
    exports.StateSpaceCalculator = StateSpaceCalculator;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RhdGVTcGFjZUNhbGN1bGF0b3IuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi8uLi9zcmMvYXBwL21vZGVscy9jb21tb24vY2FsY3VsYXRvclByb3ZpZGVyL2NhbGN1bGF0b3JzL2ZpbHRlcnMvc3RhdGVTcGFjZUNhbGN1bGF0b3IudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBQUE7UUFTSSw4QkFBWSxNQUFlLENBQUMsWUFBWSxFQUFFLEVBQWEsQ0FBQSxnQkFBZ0IsRUFBRSxFQUFhLENBQUMsZ0JBQWdCLEVBQUUsR0FBWSxFQUFFLEdBQVk7WUFQM0gsUUFBRyxHQUFjLEVBQUUsQ0FBQyxDQUFDLDJCQUEyQjtZQUNoRCxRQUFHLEdBQWMsRUFBRSxDQUFDLENBQUMsMkJBQTJCO1lBQ2hELGdCQUFXLEdBQVksR0FBRyxDQUFDLENBQUMsc0NBQXNDO1lBQ2xFLFdBQU0sR0FBWSxDQUFDLENBQUM7WUFFcEIsT0FBRSxHQUFhLEVBQUUsQ0FBQyxDQUFDLDRCQUE0QjtZQUluRCxJQUFJLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztZQUNyQixJQUFJLENBQUMsVUFBVSxDQUFFLEVBQUUsRUFBRSxFQUFFLEVBQUUsR0FBRyxFQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ3ZDLENBQUM7UUFFTSw4Q0FBZSxHQUF0QixVQUF3QixXQUFzQjtZQUMxQywwR0FBMEc7WUFDMUcsSUFBSSxDQUFDLGdCQUFnQixDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDO1lBRXRDLElBQUksWUFBWSxHQUFjLEVBQUUsQ0FBQztZQUVqQyxLQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsRUFBRSxDQUFDLEdBQUUsV0FBVyxDQUFDLE1BQU0sRUFBRSxDQUFDLEVBQUUsRUFBQztnQkFDdEMsWUFBWSxDQUFDLElBQUksQ0FBRSxJQUFJLENBQUMsVUFBVSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7YUFD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O2dCQUNoQyxDQUFDLEdBQUUsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsR0FBRyxDQUFDLENBQUMsQ0FBQyxjQUFjO2FBQ3JDLENBQUMsd0JBQXdCO1lBRTFCLE9BQU8sQ0FBQyxDQUFDO1FBQ2IsQ0FBQyxFQUFDLHNCQUFzQjtRQUM1QiwyQkFBQztJQUFELENBQUMsQUF6R0QsSUF5R0M7SUF6R1ksb0RBQW9CIiwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNsYXNzIFN0YXRlU3BhY2VDYWxjdWxhdG9yIHtcclxuICAgIFxyXG4gICAgcHJpdmF0ZSBiek4gOiBudW1iZXJbXSA9IFtdOyAvKiEgbm9ybWFsaXplZCB2ZWN0b3IgYnogKi9cclxuICAgIHByaXZhdGUgYXpOIDogbnVtYmVyW10gPSBbXTsgLyohIG5vcm1hbGl6ZWQgdmVjdG9yIGF6ICovXHJcbiAgICBwcml2YXRlIHByZXNldENvZWZmIDogbnVtYmVyID0gMC4wOyAvKiEgcmVmZXJlbmNlIHRvIHByZXNldCBjb2VmZmljaWVudCAqL1xyXG4gICAgcHJpdmF0ZSBuT3JkZXIgOiBudW1iZXIgPSAwO1xyXG4gICAgXHJcbiAgICBwcml2YXRlIHh6IDpudW1iZXJbXSA9IFtdOyAvKiEgc3RhdGUtc3BhY2UgdmVjdG9yIHh6ICovXHJcbiAgICBcclxuICAgIGNvbnN0cnVjdG9yKG5PcmRlciA6IG51bWJlciAvKiEgb3JkZXIgKi8sIGJ6IDogbnVtYmVyW10vKiEgdmVjdG9yIGJ6ICovLCBheiA6IG51bWJlcltdIC8qISB2ZWN0b3IgYXogKi8sIGJzMCA6IG51bWJlciwgYXMwIDogbnVtYmVyKXtcclxuICAgICAgICBcclxuICAgICAgICB0aGlzLm5PcmRlciA9IG5PcmRlcjtcclxuICAgICAgICB0aGlzLk5vcm1Db2VmZlMgKGJ6LCBheiwgYnMwLCBhczApO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBwdWJsaWMgQ2xjT3V0cHV0VmVjdG9yIChpbnB1dFZlY3RvciA6IG51bWJlcltdKSA6IG51bWJlcltde1xyXG4gICAgICAgIC8vIGluaXRpYWxpemUgdGhlIHN0YXRlIHNwYWNlIHZlY3RvciBzbyB0aGF0IHRoZSBmaXJzdCBvdXB1dCBtYXRjaGVzIHRoZSBmaXJzdCBlbGVtZW50IGluIHRoZSBpbnB1dCB2ZWN0b3JcclxuICAgICAgICB0aGlzLlN0YXRlU3BhY2VQcmVzZXQoaW5wdXRWZWN0b3JbMF0pO1xyXG4gICAgICAgIFxyXG4gICAgICAgIHZhciBvdXRwdXRWZWN0b3IgOiBudW1iZXJbXSA9IFtdO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZvcih2YXIgaSA9IDA7IGk8IGlucHV0VmVjdG9yLmxlbmd0aDsgaSsrKXtcclxuICAgICAgICAgICAgb3V0cHV0VmVjdG9yLnB1c2goIHRoaXMuU3RhdGVTcGFjZShpbnB1dFZlY3RvcltpXSkpOyBcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG91dHB1dFZlY3RvcjtcclxuICAgIH1cclxuICAgICAgICBcclxuICAgIHByaXZhdGUgTm9ybUNvZWZmUyggYnogOiBudW1iZXJbXS8qISB2ZWN0b3IgYnogKi8sIGF6IDogbnVtYmVyW10gLyohIHZlY3RvciBheiAqLywgYnMwIDogbnVtYmVyLCBhczAgOiBudW1iZXIpOiBib29sZWFue1xyXG4gICAgICAgIHZhciBwcmVzZXRPSyA6IGJvb2xlYW47IC8qIGludGVybmFsIHZhcmlhYmxlICovXHJcbiAgICAgICAgdmFyIGlDbnQgOiBudW1iZXI7ICAvKiBpbnRlcm5hbCB2YXJpYWJsZSAqLyBcclxuICAgICAgICBcclxuICAgICAgICBpZih0aGlzLm5PcmRlciA+IDApIC8qIHJlZ3VsYXIgY2FzZSAtIDAgPCBuT3JkZXIgPD0gMjU1ICove1xyXG4gICAgICAgICAgICB0aGlzLmJ6Tlt0aGlzLm5PcmRlcl09IGJ6W3RoaXMubk9yZGVyXSAvIGF6W3RoaXMubk9yZGVyXTsgLyogbm9ybWFsaXplZCBieltuXSAqL1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICBmb3IoaUNudD0gdGhpcy5uT3JkZXIgLSAxOyBpQ250ID4gMDsgaUNudC0tKSAvKiBub3JtYWxpemVkIGF6ICYgYnogKGluZGV4IG4tMS4uMSkgKi97XHJcbiAgICAgICAgICAgICAgICB0aGlzLmF6TltpQ250XT0gYXpbaUNudF0gLyBhelt0aGlzLm5PcmRlcl07IC8qIG5vcm1hbGl6ZWQgYXpbaV0gJiBieltpXSwgaT1uLTEuLjEgKi9cclxuICAgICAgICAgICAgICAgIHRoaXMuYnpOW2lDbnRdPSBieltpQ250XSAvIGF6W3RoaXMubk9yZGVyXSAtIHRoaXMuYXpOW2lDbnRdICogdGhpcy5iek5bdGhpcy5uT3JkZXJdO1xyXG4gICAgICAgICAgICB9IC8qIGVuZCBmb3IoKSAqL1xyXG4gICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLmF6TlswXT0gYXpbMF0gLyBhelt0aGlzLm5PcmRlcl07IC8qIG5vcm1hbGl6ZWQgYXpbMF0gJiBielswXSAqL1xyXG4gICAgICAgICAgICB0aGlzLmJ6TlswXT0gYnpbMF0gLyBhelt0aGlzLm5PcmRlcl0gLSB0aGlzLmF6TlswXSAqIHRoaXMuYnpOW3RoaXMubk9yZGVyXTtcclxuICAgICAgICBcclxuICAgICAgICAgICAgdGhpcy5hek5bdGhpcy5uT3JkZXJdPSAxLjA7IC8qIG5vcm1hbGl6ZWQgYXpbbl0gKi9cclxuICAgICAgICBcclxuICAgICAgICAgICAgaWYoTWF0aC5hYnMoYnMwKSA8PSBOdW1iZXIuTUlOX1ZBTFVFKSAvKiBwcmVzZXQgb2Ygc3RhdGUgc3BhY2Ugb3V0cHV0IHk9eTAgaXMgbm90IHBvc3NpYmxlLCBvbmx5IHJlc2V0ICh5MD0wKSB3b3JrcyAqL3tcclxuICAgICAgICAgICAgICAgIHRoaXMucHJlc2V0Q29lZmY9IDAuMDsgcHJlc2V0T0s9IGZhbHNlO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2UgLyogcHJlc2V0IG9mIHN0YXRlIHNwYWNlIG91dHB1dCB5ID0geTAgaXMgcG9zc2libGUgKi97XHJcbiAgICAgICAgICAgICAgICB0aGlzLnByZXNldENvZWZmPSBhczAgLyBiczA7IHByZXNldE9LPSB0cnVlO1xyXG4gICAgICAgICAgICB9IC8qIGVuZCBpZihBQlMoYnMwKSA8IEZMVF9FUFNJTE9OKSAqL1xyXG4gICAgICAgIH1cclxuICAgICAgICBlbHNlIC8qIHNwZWNpYWwgY2FzZSAtIG5PcmRlciA9IDAgKi97XHJcbiAgICAgICAgICAgIHRoaXMuYnpOWzBdPSBielswXSAvIGF6WzBdOyAvKiBub3JtYWxpemVkIGJ6W25dICYgYXpbMF0gKi9cclxuICAgICAgICAgICAgdGhpcy5hek5bMF09IDEuMDtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMucHJlc2V0Q29lZmY9IDAuMDsgcHJlc2V0T0s9IHRydWU7XHJcbiAgICAgICAgfSAvKiBlbmQgaWYobk9yZGVyID4gMCkgKi9cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gcHJlc2V0T0s7XHJcbiAgICB9IC8qIGVuZCBOb3JtQ29lZmZTKCkgKi9cclxuICAgICAgICBcclxuICAgIC8qISBcXGJyaWVmIEluaXRpYWxpemUgc3RhdGUtc3BhY2Ugb3V0cHV0IHkgd2l0aCBpbml0IHZhbHVlIHkwLiAqL1xyXG4gICAgcHJpdmF0ZSBTdGF0ZVNwYWNlUHJlc2V0KCB5MCA6IG51bWJlciAvKiEgaW5pdCBvdXRwdXQgdmFsdWUgKi8pe1xyXG4gICAgICAgIHZhciBpQ250OiBudW1iZXIgPSAwOyAgIC8qaW50ZXJuYWwgdmFyaWFibGUqL1xyXG4gICAgICAgIHZhciB1MCA6IG51bWJlciA9IDA7IC8qaW50ZXJuYWwgdmFyaWFibGVzKi9cclxuICAgICAgICB2YXIgeHpuIDogbnVtYmVyID0gMDsgICAvKmludGVybmFsIHZhcmlhYmxlcyovXHJcbiAgICAgICAgICAgICAgICBcclxuICAgICAgICBpZih0aGlzLm5PcmRlciA+IDApIC8qIHJlZ3VsYXIgY2FzZSAtIDAgPCBuT3JkZXIgPD0gMjU1ICove1xyXG4gICAgICAgICAgICB1MD0geTAgKiB0aGlzLnByZXNldENvZWZmOyAvKiB5MCA9IHh6W24tMV0gKyBiek5bbl0gKiB1MCAqL1xyXG4gICAgICAgICAgICB4em49IHkwIC0gdGhpcy5iek5bdGhpcy5uT3JkZXJdICogdTA7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnh6WzBdPSAwLjAgLSB0aGlzLmF6TlswXSAqIHh6biArIHRoaXMuYnpOWzBdICogdTA7IC8qIHh6WzBdICovXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBmb3IoaUNudD0gMTsgaUNudCA8ICh0aGlzLm5PcmRlciAtIDEpOyBpQ250KyspIC8qIHN0YXRlIHZlY3RvciAoaW5kZXggMS4ubi0xKSAqL3tcclxuICAgICAgICAgICAgICAgIHRoaXMueHpbaUNudF09IHRoaXMueHpbaUNudCAtIDFdIC0gdGhpcy5hek5baUNudF0gKiB4em4gKyB0aGlzLmJ6TltpQ250XSAqIHUwOyAvKiB4eltpXSwgaT0xLi5uLTEgKi9cclxuICAgICAgICAgICAgfSAvKiBlbmQgZm9yKCkgKi9cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIHRoaXMueHpbdGhpcy5uT3JkZXIgLSAxXT0geHpuO1xyXG4gICAgICAgIH0gLyogZW5kIGlmKG5PcmRlciA+IDApICovXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgIHJldHVybjtcclxuICAgIH0gLyogZW5kIFN0YXRlU3BhY2VQcmVzZXQoKSAqL1xyXG4gICAgXHJcbiAgICBcclxuICAgIC8qISBcXGJyaWVmIFRpbWUgZGlzY3JldGUgU0lTTyBzdGF0ZS1zcGFjZSBzeXN0ZW0uICovXHJcbiAgICBwcml2YXRlIFN0YXRlU3BhY2UoIHUgOiBudW1iZXIvKiEgaW5wdXQgKi8pIDogbnVtYmVye1xyXG4gICAgICAgIHZhciBpQ250IDogbnVtYmVyID0gMDsgIC8qIGludGVybmFsIHZhcmlhYmxlICovXHJcbiAgICAgICAgdmFyIHh6biA6IG51bWJlciA9IDAuMDsgLyogaW50ZXJuYWwgdmFyaWFibGUgKi9cclxuICAgICAgICB2YXIgeSA6IG51bWJlciA9IDAuMDsgICAvKiBpbnRlcm5hbCB2YXJpYWJsZSAqL1xyXG4gICAgICAgICAgICAgICAgXHJcbiAgICAgICAgaWYodGhpcy5uT3JkZXIgPiAwKSAvKiByZWd1bGFyIGNhc2UgLSAwIDwgbk9yZGVyIDw9IDI1NSAqL3tcclxuICAgICAgICAgICAgeT0gdGhpcy54elt0aGlzLm5PcmRlciAtIDFdICsgdGhpcy5iek5bdGhpcy5uT3JkZXJdICogdTsgLyogb3V0cHV0IHkgKi9cclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIGZvcih4em49IHRoaXMueHpbdGhpcy5uT3JkZXIgLSAxXSwgaUNudD0gdGhpcy5uT3JkZXIgLSAxOyBpQ250ID4gMDsgaUNudC0tKSAvKiBuZXcgc3RhdGUgdmVjdG9yIChpbmRleCBuLTEuLjEpICove1xyXG4gICAgICAgICAgICAgICAgdGhpcy54eltpQ250XT0gdGhpcy54eltpQ250IC0gMV0gLSB0aGlzLmF6TltpQ250XSAqIHh6biArIHRoaXMuYnpOW2lDbnRdICogdTsgLyogeHpbaV0sIGk9bi0xLi4xICovXHJcbiAgICAgICAgICAgIH0gLyogZW5kIGZvcigpICovXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICB0aGlzLnh6WzBdPSAwLjAgLSB0aGlzLmF6TlswXSAqIHh6biArIHRoaXMuYnpOWzBdICogdTsgLyogeHpbMF0gKi9cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxzZSAvKiBzcGVjaWFsIGNhc2UgLSBuT3JkZXIgPSAwICove1xyXG4gICAgICAgICAgICB5PSB0aGlzLmJ6TlswXSAqIHU7IC8qIG91dHB1dCB5ICovXHJcbiAgICAgICAgfSAvKiBlbmQgaWYobk9yZGVyID4gMCkgKi9cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4geTtcclxuICAgIH0gLyogZW5kIFN0YXRlU3BhY2UoKSAqL1xyXG59Il19